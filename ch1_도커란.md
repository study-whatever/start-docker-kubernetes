📖 **목차**
- [도커(Docker)](#---docker-)
  * [**도커와 관련된 프로젝트**](#----------------)
- [01 가상 머신과 도커 컨테이너](#01---------------)
  * [**기존 가상화 기술**](#-------------)
  * [도커 컨테이너](#-------)
- [02 도커를 시작해야 하는 이유](#02---------------)
  * [애플리케이션의 개발과 배포가 편해집니다](#---------------------)
  * [여러 애플리케이션의 독립성과 확장성이 높아집니다](#--------------------------)
- [03 도커 엔진 설치](#03---------)
  * [도커 엔진의 종류 및 버전](#--------------)
  * [리눅스 도커 엔진 설치](#------------)
  * [윈도우, 맥 SO에 도커 설치](#-------so-------)
  * [리눅스 환경에 도커 마련하기](#---------------)
  * 
---

## 도커(Docker)


- 리눅스 컨테이너에 여러 기능을 추가함으로써 애플리케이션을 컨테이너로서 좀 더 쉽게 사용할 수 있게 만들어진 오픈소스 프로젝트
- Go 언어로 작성됨
- 기존 가상 머신과는 달리 **성능의 손실이 거의 없어** 차세대 클라우드 인프라 솔루션으로서 많은 주목 받음

### 도커와 관련된 프로젝트

- 도커 컴포즈(Docker Compose)
- 레지스트리(Private Registry)
- 도커 허브(Docker Hub)
- Docker for Desktop
- 도커 엔진(Docker Engine)

일반적으로 도커라고 하면 도커 엔진(Docker Engine) 혹은 도커에 관련된 모든 프로젝트를 의미

- 도커 엔진은 컨테이너를 생성하고 관리하는 주체로, 자체로도 컨테이너를 제어하고 다양한 기능을 제공하는 도커의 주 프로젝트임
- 도커 생태계에 있는 여러 프로젝트들은 도커 엔진을 좀 더 효율적으로 사용하기 위한 것에 불과함 ⇒ 핵심은 도커 엔진

이번 장에서는 도커 엔진을 사용하는 

## 01 가상 머신과 도커 컨테이너

### 기존 가상화 기술

- 하이퍼바이저를 이용해 여러 개의 운영체제를 하나의 호스트에서 생성해 사용하는 방식
- 여러 개의 운영체제가 가상 머신이라는 단위로 구분됨
- 각 가상 머신에는 우분투, CentOS 등의 운영체제가 설치되어 사용됨
- 하이퍼바이저에 의해 생성되고 관리되는 운영체제 = 게스트 운영체제(Guest OS)
    - 다른 게스트 운영체제와는 완전히 독립된 공간과 시스템 자원을 할당받음
- 가상화 툴: VirtualBox, VMware

![Image](https://github.com/user-attachments/assets/cc0fcf58-10dd-4506-8e0a-0a7130050052)

**장점**

- 완벽한 운영체제를 생성할 수 있음

**단점**

- 시스템 자원 가상화하고 독립된 공간을 생성하려면 반드시 하이퍼바이저를 거쳐야 함 
→ 일반 호스트에 비해 성능 손실 발생
- 가상 머신은 게스트 운영체제를 사용하기 위한 라이브러리, 커널 등 전부 포함하기 때문에 가상 머신을 배포하기 위한 이미지로 만들었을 때 이미지 크기가 커짐 
→ 큰 이미지를 애플리케이션으로 배포하기는 부담스러움

반면,

### 도커 컨테이너

- 가상화된 공간 생성하기 위해 리눅스 자체 기능인 chroot, namespace, cgroup을 사용함으로써 **프로세스 단위의 격리 공간을 만듦** → 성능 손실이 거의 없음
- 컨테이너에 필요한 커널은 호스트의 커널을 공유해서 사용하고, 컨테이너 안에는 애플리케이션을 **구동하는 데 필요한 라이브러리 및 실행파일만 존재함** → 이미지 용량 대폭 줄어듦
- 따라서 컨테이너를 이미지로 만들어 배포하는 시간이 가상 머신에 비해 빠르고 가상화된 공간을 사용할 때의 성능 손실도 거의 없음

<br>

## 02 도커를 시작해야 하는 이유

컨테이너는 몇 가지 존재하지만 그중 도커는 컨테이너 생태계에서 사실상 표준으로서 사용되고 있음 

따라서 쿠버네티스, 메소스와 같은 오픈소스 프로젝트에서도 도커를 기준으로 개발되고 있음 

왜 많은 회사와 프로젝트가 도커를 선택했는지, 왜 도커를 시작해야 했는지에 대해 설명

### 애플리케이션의 개발과 배포가 편해집니다

- 서버 부팅할 때 실행되는 운영체제: **호스트 OS**
- 도커 컨테이너는 호스트 OS 위에서 실행되는 격리된 공간임
- 컨테이너 자체에 특별한 권한을 주지 않는 한, 컨테이너 내부에서 수많은 소프트웨어를 설치하고 설정 파일 수정해도 호스트 OS에는 영향 끼치지 않음

⇒ 독립된 개발 환경을 보장받을 수 있음 

- 배포하려고 한다면, 컨테이너를 ‘도커 이미지’라고 하는 일종의 패키지로 만들어 운영 서버에 전달하기만 하면 됨
- 컨테이너에서 사용되던 운영 서버에서 새롭게 패키지 설치할 필요 없고 각종 라이브러리 설치 등으로 인한 의존성 걱정할 필요 없음
- 서비스 개발했을 때 사용한 환경을 다른 서버에서도 컨테이너로서 똑같이 복제할 수 있기 때문에 개발/운영 환경의 통합이 가능해짐

- 도커 이미지는 가상 머신 이미지와 달리 커널을 포함하고 있지 않기 때문에 이미지 크기가 크지 않음
- 도커는 이미지 내용을 레이어 단위로 구성하고 중복되는 레이어를 재사용할 수 있어 배포 속도가 매우 빨라짐

### 여러 애플리케이션의 독립성과 확장성이 높아집니다

<img width="497" alt="Image" src="https://github.com/user-attachments/assets/85044921-cde8-42d6-91b7-f968ac7db171" />

**모놀리스(Monolith) 애플리케이션**

- 소프트웨어 여러 모듈이 상호 작용하는 로직을 하나의 프로그램 내에서 구동시키는 방식
- 소규모 서비스에서는 어울리지만, 서비스 기능이 복잡하고 거대해질수록 소프트웨어 자체의 확장성과 유연성이 줄어듦

**마이크로서비스(microservice) 구조**

- 모놀리스 방식을 대체하기 위해 떠오른 개념
- 여러 모듈을 독립된 형태로 구성하기 때문에 언어에 종속되지 않음
- 변화에 빠르게 대응 가능
- 각 모듈 관리 쉬워짐
- 컨테이너는 수 초 내로 생성, 시작이 가능할 뿐만 아니라 여러 모듈에게 독립된 환경을 동시에 제공할 수 있기 때문에 마이크로서비스 구조에서 가장 많이 사용되고 있음

웹 서비스는 데이터베이스와 웹 서버 컨테이너를 분리할 수 있고, 부하 발생할 때 마이크로서비스 구조의 웹 서버 컨테이너만을 동적으로 늘려서 부하를 분산할 수 있음 

이미지 버전을 독립적으로 관리하기 때문에 유지보수도 용이함 

컨테이너 기반의 마이크로서비스는 개발자가 그 구조를 직접 구현하기 보다는 도커 스웜 모드, 쿠버네티스 등의 컨테이너 오케스트레이션 플랫폼을 통해 사용하는 것이 일반적임 

이 외에도 프로젝트 자체의 성숙도, 확장성, 편의성 등으로 도커 컨테이너를 사용함 

## 03 도커 엔진 설치

- 도커는 다양한 운영체제 사용 가능
    - 리눅스 컨테이너를 제어하는 API를 Go 언어로 구현한 Libcontainer 를 사용해서 대부분의 리눅스 운영체제를 사용할 수 있음
    - 많이 싸는 대표적인 리눅스 운영체제: CentOS, 우분투
- 가능하다면 지원이 중단되지 않은 최신 버전의 운영체제 배포판을 사용하는 것이 좋음
- 마이크로소프트 윈도우, 맥 OS X에서도 도커를 사용할 수 있지만 특정 버전의 운영체제를 사용한다면 도커를 사용하기 위해 가상화 공간을 별도로 생성해야 함
- 도커가 어느 운영체제에 설치되든 사용법은 거의 같음

### 도커 엔진의 종류 및 버전

2017년 이전의 도커 엔진은 1.12 같이 1.x 버전으로 표기됨 

그러나 1.13 을 마지막으로, 3월부터 도커 EE(Docker Enterprise Edition)와 도커 CE(Community Edition)으로 구분되어 제공됨

버전 이름도 17.03-EE 또는 17.03-CE 와 같이 `(출시 년도)-(출시 월)-(도커 엔진 종류)` 의 형태로 변경됨 

**도커EE**

- 유로로 제공되는 기업용 솔루션
- 각종 기술 지원 및 실제 서비스 단계에서 필요한 각종 부가 기능들을 도커 엔진과 함께 제공함
- 3개월마다 안정화된 버전으로 릴리스됨

**도커 CE**

- 무료로 제공되는 도커 엔진
- 별도 기술 지원 및 서비스를 제공하지 않지만 도커 엔진 자체의 핵심적인 기능을 무료로 사용할 수 있음
- stable, edge 버전으로 구분해 각각 3개월, 1개월 단위로 릴리스됨

앞으로 다룰 내용은 도커 CE를 기준으로 설명함 

또한 edge 버전은 새로운 기능을 먼저 사용해 볼 수 있다는 장점이 있지만 각종 버그가 발생할 수 있기 때문에 가능하면 CE 의 stable 버전을 사용하는 것을 권장함 

### 리눅스 도커 엔진 설치

- 최신 버전 커널 사용하고 있는지 확인: 최소 3.10 버전 이상에서 가능
    
    `uname -r` 명령어로 확인
    
- 지워 기간 내에 있는 배포판인지 확인
    - 기술 지원 지속되고 있는 운영체제는 우분투 14.04, 16.04, 18.04, CentOS 7
- 64비트 리눅스인지 확인
    - 도커는 64비트에 최적화
- sudo 명령어를 통해 설치하거나 root 권한을 소유한 계정에서 설치해야함

리눅스 운영체제 설치 방법

<img width="534" alt="Image" src="https://github.com/user-attachments/assets/aa615a0f-6330-435d-9944-bc51e81a0c92" />

<img width="539" alt="Image" src="https://github.com/user-attachments/assets/f463741f-7b39-4107-b46c-75bddaae19a4" />


현재 사용 가능한 최신 버전의 도커 엔진 설치

<img width="532" alt="Image" src="https://github.com/user-attachments/assets/bb8f8c9c-93cd-4113-9974-4956871273f6" />

### 윈도우, 맥 SO에 도커 설치

윈도우와 맥 OSX에서도 간단한 테스트나 개발 용도로 사용할 수 있음 

- 일반적으로 Docker Desktop

단, Docker Desktop 에서는 도커에서 제공하는 네트워크, 볼륨 기능 등이 일부 지원되지 않을 수 있고 예상치 못한 버그를 마주할 수 있음 

https://www.docker.com/pricing/

docker 홈페이지에서 다운 


> 💡
> Docker Desktop 은 가상 환경을 생성하기 위해 리눅스킷(Linuxkit)이라고 불리는 툴을 이용함
> 
> 최소화된 리눅스 커널만을 탑재한 뒤 필요한 작업만 컨테이너 기반의 서비스로 정의해 사용함
> 
> 가상 환경에서 실행되는 도커 엔진 또한 리눅스킷의 커널을 따르게 됨 


### 리눅스 환경에 도커 마련하기

여러 커뮤니티에서 리눅스로 도커를 실행하는 것을 권장하지만, 도커로 개발하기 위해 리눅스 물리 서버를 직접 구하기는 쉽지 않음 

→ 버추얼박스와 EC2 를 사용해서 마련할 수 있음 

1. 버추얼박스, VMWare
    
    가상화 도구로 리눅스 환경을 생성한 뒤 도커를 설치하는 것 
    
    실제 리눅스를 사용하는 것처럼 도커를 연습할 수 있어 컨테이너 애플리케이션을 개발하는 용도로 많이 사용됨 
    
    버추얼박스에서 각 운영체제에 맞는 설치 파일 다운 받고
    
    가상 머신에 사용될 이미지 파일(.iso)를 다운 받음 `http://releases.ubuntu.com/16.04`
    
    리눅스 사용하는 데 익숙하다면 서버 버전을, 그렇지 않다면 데스크톱 버전 사용 
    
2. EC2
    
    AWS의 EC2를 사용하면 새로운 인스턴스를 생성해 IP를 할당받아 PuTTY, Xshell 등 SSH 클라이언트로 해당 서버에 접속해 리눅스 환경을 사용할 수 있음 
    
    원하는 성능의 서버를 생성해 사용한 시간만큼 요금을 지불하기 때문에 필요할 때마다 간편하게 리눅스 사용할 수 있지만, 오랜 기간 동안 높은 성능의 서버를 사용한다면 요금을 많이 지불해야 함
    
    AWS  > EC2 에서 인스턴스 생성하고, 운영체제 선택(여기서는 Ubuntu Server 18.04 LTS 선택) > 인스턴스 성능 선택 > 키 발급 > 인스턴스 시작 
    
    내려받은 키 파일(.pem)과 인스턴스 Public IP 를 사용하여 인스턴스에 접근할 수 있음 
    
    `ssh -i mykey.pem ubuntu@52.78...`
